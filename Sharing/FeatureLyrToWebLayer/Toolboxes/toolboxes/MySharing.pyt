# -*- coding: utf-8 -*-import arcpyimport osimport sysclass Toolbox:    def __init__(self):        """Define the toolbox (the name of the toolbox is the name of the        .pyt file)."""        self.label = "Custom Sharing"        self.alias = "CustomSharing"        # List of tool classes associated with this toolbox        self.tools = [PublishFeatureLyr]class PublishFeatureLyr:    def __init__(self):        """Define the tool (tool name is the name of the class)."""        self.label = "PublishFeatureLyr"        self.description = "Publishes a feature layer as a web layer"    def getParameterInfo(self):        """Define the tool parameters."""        # Layer parameter        param0 = arcpy.Parameter(        displayName="Input Feature Layer",        name="in_feature",        datatype="GPFeatureLayer",        parameterType="Required",        direction="Input")        # Web service name        param1 = arcpy.Parameter(        displayName="Web Service Name",        name="serviceName",        datatype="GPString",        parameterType="Required",        direction="Input")        param1.value = "My Feature Service"        # sharing_draft.summary        param2 = arcpy.Parameter(        displayName="Service Summary",        name="serviceSummary",        datatype="GPString",        parameterType="Required",        direction="Input")        param2.value = "This is a summary of the web layer service."        # sharing_draft.description =         param3 = arcpy.Parameter(        displayName="Service Description",        name="serviceDescription",        datatype="GPString",        parameterType="Required",        direction="Input")        param3.value = "This is a description of the web layer."                # sharing_draft.credits        param4 = arcpy.Parameter(        displayName="Service Credits",        name="serviceCredits",        datatype="GPString",        parameterType="Required",        direction="Input")        param4.value = "Your credits here."                        # sharing_draft.useLimitations        param5 = arcpy.Parameter(        displayName="Service Use Limits",        name="serviceUseLimits",        datatype="GPString",        parameterType="Required",        direction="Input")        param5.value = "Your use limitations here."                # sharing_draft.portalFolder        param6 = arcpy.Parameter(        displayName="Service Portal Folder Name",        name="servicePortalFolder",        datatype="GPString",        parameterType="Required",        direction="Input")        param6.value = "MyFolder"        # sharing_draft.tags        param7 = arcpy.Parameter(        displayName="Service Tags",        name="serviceTags",        datatype="GPString",        parameterType="Required",        direction="Input")        param7.value = "Tag1, Tag2"                # output parameter: operation result        param8 = arcpy.Parameter(        displayName="Operation Result",        name="out_result",        datatype="GPString",        parameterType="Derived",        direction="Output")        paramList = [param0, param1, param2, param3, param4, param5, param6, param7, param8]        return paramList    def isLicensed(self):        """Set whether the tool is licensed to execute."""        return True    def updateParameters(self, parameters):        """Modify the values and properties of parameters before internal        validation is performed.  This method is called whenever a parameter        has been changed."""        return    def updateMessages(self, parameters):        """Modify the messages created by internal validation for each tool        parameter. This method is called after internal validation."""        return    def execute(self, parameters, messages):        """The source code of the tool."""        portal_url = arcpy.GetActivePortalURL()        # Open the ArcGIS Pro project and map        aprx = arcpy.mp.ArcGISProject("CURRENT")        homeFolder = aprx.homeFolder        logFilePath = os.path.join(homeFolder,"MySharingLog.txt")        logFile = open(logFilePath, 'w')        logFile.write('Home folder: '+homeFolder+'\n')        logFile.write('Portal Url: '+portal_url+'\n')        # Get the layer to publish        layerParam = parameters[0]        logFile.write('Layer Type: '+str(type(layerParam))+'\n')        layerName = parameters[0].valueAsText         logFile.write('Layer: '+layerName+'\n')        # Sign in to the portal        # assume already signed in: arcpy.SignInToPortal(portal_url, username, password)        # Create a sharing draft for the web layer        # map_obj = aprx.listMaps("Map")[0]  # Replace "Map" with your map name if different        map_obj = aprx.listMaps()[0]  # Assuming the first map in the project        layer = map_obj.listLayers(layerName)[0]        logFile.write('Layer: '+layer.name+'\n')                # Define the service details        service_name = parameters[1].valueAsText        server_type = "HOSTING_SERVER"  # For ArcGIS Online or Portal        service_type = "FEATURE"  # Publishing a feature layer        # Create the FeatureSharingDraft object for the given layer        sharing_draft = map_obj.getWebLayerSharingDraft(server_type, service_type, service_name, [layer])        # Set sharing properties        sharing_draft.summary = parameters[2].valueAsText        sharing_draft.description = parameters[3].valueAsText        sharing_draft.credits = parameters[4].valueAsText        sharing_draft.useLimitations = parameters[5].valueAsText        sharing_draft.portalFolder = parameters[6].valueAsText        sharing_draft.tags = parameters[7].valueAsText        sharing_draft.sharing.sharingLevel = "EVERYONE"        sharing_draft.featureCapabilities = "Extract"        sharing_draft.useCIMSymbols = True        sharing_draft.sharing.groups = ""  # Group names = "group1,group2"        # Save the draft to a temporary file        draft_file = os.path.join(homeFolder,"WebLayerDraft.sddraft") # r"C:\Path\To\Temp\WebLayerDraft.sddraft"        logFile.write('Draft: '+draft_file+'\n')        sharing_draft.exportToSDDraft(draft_file)        # Stage the service definition        sd_file = os.path.join(homeFolder,"WebLayer.sd") # r"C:\Path\To\Temp\WebLayer.sd"        logFile.write ('SD WebLayer: '+sd_file+'\n')        arcpy.StageService_server(draft_file, sd_file)        # Upload and publish the service definition        arcpy.UploadServiceDefinition_server(sd_file, "My Hosted Services")        print("Web layer published successfully!")        parameters[8].value = "Web layer published successfully!"        return "Web layer published successfully!"    def postExecute(self, parameters):        """This method takes place after outputs are processed and        added to the display."""        return